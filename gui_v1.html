<html>
	<head>
		<title>Equip Region Checker</title>
		<!-- <script src="vdf.js"></script> -->
		<script src="equip_check.js"></script>

		<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
		<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
		<script>
			var check_conflicts = function(){
				$('#conflict-status').html('Checking...');
				var conflict_status = '';

				for(var i=0; i<selected_items.length; i++){
					var itemA = selected_items[i];
					for(var j=i+1; j<selected_items.length; j++){
						var itemB = selected_items[j];
						var conflict = has_conflict(itemA, itemB);
						if(conflict){
							conflict_status += "Conflict between '" + itemA['name'] + "' and '" + itemB['name'] + "'.<br/>";
						}
					}
				}

				if(conflict_status.length==0){
					$('#conflict-status').text("No conflicts!");
				} else {
					$('#conflict-status').html(conflict_status);
				}
			};

			var on_select_update = function(event, ui){
				var item_idx = event.target.id.split('-')[1];

				var new_item = items_list[ui.item.value];
				selected_items[item_idx-1] = new_item;

				var item_image_url = new_item['image_url'];
				$("#item-"+item_idx+"-image").attr('src', item_image_url);

				check_conflicts();
			};

			window.onload = function() {
				var items_data_loaded = function(data){
					items_list = JSON.parse(data); 
					selected_items = [];
					var items_names_list = [];
					for(var name in items_list){
						items_names_list.push(items_list[name]['name']);
					}
					console.log('FINISHED LOADING ITEMS');

					var autocomplete_options = {
						source: items_names_list,
						select: on_select_update
					};
					$("#item-1-entry").autocomplete(autocomplete_options);
					$("#item-2-entry").autocomplete(autocomplete_options);
					$("#item-3-entry").autocomplete(autocomplete_options);
					$("#item-4-entry").autocomplete(autocomplete_options);
				};
				fetch_item_list(items_data_loaded);
			};
	  </script>
	</head>
	<body>
		<div>
			<table>
				<tr>
					TODO: Limit by class
				</tr>
				<tr>
					<td>Cosmetic item #1</td>
					<td>Cosmetic item #2</td>
					<td>Cosmetic item #3</td>
					<td>Weapon/Canteen</td>
				</tr>
				<tr>
					<td>
						<input id="item-1-entry">
					</td><td>
						<input id="item-2-entry">
					</td><td>
						<input id="item-3-entry">
					</td><td>
						<input id="item-4-entry">
					</td>
				</tr>
				<tr>
					<td>
						<img id="item-1-image" src="empty.png"/><br>
					</td><td>
						<img id="item-2-image" src="empty.png"/><br>
					</td><td>
						<img id="item-3-image" src="empty.png"/><br>
					</td><td>
						<img id="item-4-image" src="empty.png"/><br>
					</td>
				</tr>
			</table>

			<label id="conflict-status">No conflicts!</label>
		</div>
	</body>
</html>
